using System;
using System.Threading;

class TaiKhoanNganHang
{
    private object khoa = new object();
    private decimal soDu;

    public TaiKhoanNganHang(decimal soDuBanDau)
    {
        soDu = soDuBanDau;
    }

    public decimal LaySoDu()
    {
        return soDu;
    }

    public void NapTien(int i)
    {
        lock (khoa)
        {
            Console.Write("Nap tien lan {0}: ",i + 1);
            decimal soTien = Convert.ToDecimal(Console.ReadLine());
            soDu += soTien;
            Console.WriteLine("Nap {0}. So du moi: {1}",soTien,soDu);
        }
    }

    public void RutTien(int i)
    {
        lock (khoa)
        {
            Console.Write("Rut tien lan {0}: ", i+1);
            decimal soTien = Convert.ToDecimal(Console.ReadLine());
            if (soDu >= soTien)
            {
                soDu -= soTien;
                Console.WriteLine("Rut {0}. So du moi: {1}", soTien, soDu);
            }
            else
            {
                Console.WriteLine("Khong du tien trong tai khoan.");
            }
        }
    }
}

class ChuongTrinh
{
    static void Main()
    {
        Console.Write("Nhap ten nguoi dung: ");
        string tenNguoiDung = Console.ReadLine();

        Console.Write("Nhap so tien ban dau trong tai khoan: ");
        decimal soDuBanDau = Convert.ToDecimal(Console.ReadLine());

        TaiKhoanNganHang taiKhoan = new TaiKhoanNganHang(soDuBanDau);

        Thread luongNapTien = new Thread(() =>
        {
            for (int i = 0; i < 5; i++)
            {
                taiKhoan.NapTien(i);
                Thread.Sleep(100);
            }
        });

        Thread luongRutTien = new Thread(() =>
        {
            for (int i = 0; i < 5; i++)
            {
                taiKhoan.RutTien(i);
                Thread.Sleep(100);
            }
        });

        luongNapTien.Start();
        luongRutTien.Start();
        luongNapTien.Join();
        luongRutTien.Join();

        Console.WriteLine("So du cuoi cung cua {0}: {1}", tenNguoiDung, taiKhoan.LaySoDu());
        Console.ReadKey();
    }
}